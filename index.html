<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>PopClick World</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
body {
    height: 100vh;
    background: radial-gradient(circle at top, #222, #000);
    color: white;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
}
#game {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
#score {
    font-size: 4rem;
    margin-bottom: 10px;
}
#cat {
    font-size: 28vw;
    cursor: pointer;
    user-select: none;
    transition: transform 0.05s;
}
#cat:active {
    transform: scale(0.95);
}
#country {
    margin-top: 10px;
    font-size: 1.2rem;
    opacity: 0.8;
}
#leaderboard {
    width: 100%;
    max-height: 30vh;
    background: rgba(0,0,0,0.8);
    border-top: 2px solid #333;
    overflow-y: auto;
}
table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    padding: 10px;
    text-align: center;
}
th {
    background: #111;
    position: sticky;
    top: 0;
}
</style>
</head>
<body>

<div id="game">
    <div id="score">0</div>
    <div id="cat">üò∫</div>
    <div id="country">üåç Naƒç√≠t√°m st√°t‚Ä¶</div>
</div>

<div id="leaderboard">
<table>
<thead>
<tr>
<th>#</th>
<th>Vlajka</th>
<th>St√°t</th>
<th>Sk√≥re</th>
</tr>
</thead>
<tbody id="board"></tbody>
</table>
</div>

<script>
let score = 0;
let countryName = "Unknown";
let countryCode = "UN";

const scoreEl = document.getElementById("score");
const boardEl = document.getElementById("board");
const countryEl = document.getElementById("country");

function flagEmoji(code) {
    return code
        .toUpperCase()
        .replace(/./g, c => 
            String.fromCodePoint(127397 + c.charCodeAt())
        );
}

fetch("https://ipapi.co/json/")
.then(res => res.json())
.then(data => {
    countryName = data.country_name || "Unknown";
    countryCode = data.country_code || "UN";
    countryEl.textContent = `${flagEmoji(countryCode)} ${countryName}`;
    updateBoard();
});

function getData() {
    return JSON.parse(localStorage.getItem("popclickScores")) || {};
}

function saveData(data) {
    localStorage.setItem("popclickScores", JSON.stringify(data));
}

function updateBoard() {
    const data = getData();
    const list = Object.entries(data)
        .sort((a,b)=>b[1]-a[1])
        .slice(0,10);

    boardEl.innerHTML = "";
    list.forEach((item,i)=>{
        boardEl.innerHTML += `
        <tr>
            <td>${i+1}</td>
            <td>${flagEmoji(item[0].slice(0,2).toUpperCase())}</td>
            <td>${item[0]}</td>
            <td>${item[1]}</td>
        </tr>`;
    });
}

document.getElementById("cat").onclick = () => {
    score++;
    scoreEl.textContent = score;

    const data = getData();
    data[countryName] = Math.max(data[countryName] || 0, score);

    saveData(data);
    updateBoard();
};

updateBoard();
</script>

</body>
</html>
